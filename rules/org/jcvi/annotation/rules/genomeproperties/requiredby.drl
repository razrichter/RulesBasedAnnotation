#created on: Apr 6, 2010
package org.jcvi.annotation.rules.genomeproperties
import org.jcvi.annotation.facts.*;

rule "FeatureProperty required_by GenomeProperty"
	
	when
		# If a GenomeProperty has been assigned, and 
		# the GenomeProperty requires a FeatureProperty, and
		# there does not exist a Feature containing such a FeatureProperty
		# then it should be removed from the properties associated with the genome
		featureprop	 	:FeatureProperty()
		genomeprop	 	:GenomeProperty()
		relationship	:PropertyRelationship(
							subject 	== featureprop, 
							type	 	== RelationshipType.REQUIRED_BY, 
							object 		== genomeprop )
		genome			: Genome( properties contains genomeprop )
		not( Feature( properties contains featureprop, genome == genome ) )
		
 	then 
		# remove the genome property on the genome
		System.out.println("Removing genomeprop " + genomeprop.toString());
		System.out.println("  since it requires missing FeatureProperty " + featureprop.toString());
		genome.removeProperty(genomeprop);
		update(genome);
end
